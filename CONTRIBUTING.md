# Contribution guide
We're glad you're interested in contributing Misskey! In this document you will find the information you need to contribute to the project.

> [!NOTE]
> This project uses Japanese as its major language, **but you do not need to translate and write the Issues/PRs in Japanese.**
> Also, you might receive comments on your Issue/PR in Japanese, but you do not need to reply to them in Japanese as well.\
> The accuracy of machine translation into Japanese is not high, so it will be easier for us to understand if you write it in the original language.
> It will also allow the reader to use the translation tool of their preference if necessary.

## Roadmap
See [ROADMAP.md](./ROADMAP.md)

## Issues
Before creating an issue, please check the following:
- To avoid duplication, please search for similar issues before creating a new issue.
- Do not use Issues to ask questions or troubleshooting.
	- Issues should only be used to feature requests, suggestions, and bug tracking.
	- Please ask questions or troubleshooting in [GitHub Discussions](https://github.com/misskey-dev/misskey/discussions) or [Discord](https://discord.gg/Wp8gVStHW3).

> [!WARNING]
> Do not close issues that are about to be resolved. It should remain open until a commit that actually resolves it is merged.

### Recommended discussing before implementation
We welcome your proposal.

When you want to add a feature or fix a bug, **first have the design and policy reviewed in an Issue** (if it is not there, please make one). Without this step, there is a high possibility that the PR will not be merged even if it is implemented.

At this point, you also need to clarify the goals of the PR you will create, and make sure that the other members of the team are aware of them.
PRs that do not have a clear set of do's and don'ts tend to be bloated and difficult to review.

Also, when you start implementation, assign yourself to the Issue (if you cannot do it yourself, ask Committer to assign you).
By expressing your intention to work on the Issue, you can prevent conflicts in the work.

To the Committers: you should not assign someone on it before the Final Decision.

### How issues are triaged

The Committers may:
* close an issue that is not reproducible on latest stable release,
* merge an issue into another issue,
* split an issue into multiple issues,
* or re-open that has been closed for some reason which is not applicable anymore.

@syuilo reserves the Final Decision rights including whether the project will implement feature and how to implement, these rights are not always exercised.

## Well-known branches
- **`master`** branch is tracking the latest release and used for production purposes.
- **`develop`** branch is where we work for the next release.
	- When you create a PR, basically target it to this branch.
- **`l10n_develop`** branch is reserved for localization management.

## Creating a PR
Thank you for your PR! Before creating a PR, please check the following:
- If possible, prefix the title with a keyword that identifies the type of this PR, as shown below.
	- `fix` / `refactor` / `feat` / `enhance` / `perf` / `chore` etc
	- Also, make sure that the granularity of this PR is appropriate. Please do not include more than one type of change or interest in a single PR.
- If there is an Issue which will be resolved by this PR, please include a reference to the Issue in the text.
- Please add the summary of the changes to [`CHANGELOG.md`](/CHANGELOG.md). However, this is not necessary for changes that do not affect the users, such as refactoring.
- Check if there are any documents that need to be created or updated due to this change.
- If you have added a feature or fixed a bug, please add a test case if possible.
- Please make sure that tests and Lint are passed in advance.
	- You can run it with `pnpm test` and `pnpm lint`. [See more info](#testing)
- If this PR includes UI changes, please attach a screenshot in the text.

Thanks for your cooperation ü§ó

### Additional things for ActivityPub payload changes
*This section is specific to misskey-dev implementation. Other fork or implementation may take different way. A significant difference is that non-"misskey-dev" extension is not described in the misskey-hub's document.*

If PR includes changes to ActivityPub payload, please reflect it in [misskey-hub's document](https://github.com/misskey-dev/misskey-hub-next/blob/master/content/ns.md) by sending PR.

The name of purporsed extension property (referred as "extended property" in later) to ActivityPub shall be prefixed by `_misskey_`. (i.e. `_misskey_quote`)

The extended property in `packages/backend/src/core/activitypub/type.ts` **must** be declared as optional because ActivityPub payloads that comes from older Misskey or other implementation may not contain it.

The extended property must be included in the context definition. Context is defined in `packages/backend/src/core/activitypub/misc/contexts.ts`.
The key shall be same as the name of extended property, and the value shall be same as "short IRI".

"Short IRI" is defined in misskey-hub's document, but usually takes form of `misskey:<name of extended property>`. (i.e. `misskey:_misskey_quote`)

One should not add property that has defined before by other implementation, or add custom variant value to "well-known" property.

## Reviewers guide
Be willing to comment on the good points and not just the things you want fixed üíØ

Ë™≠„Çì„Åß„Åä„Åè„Å®„ÅÑ„ÅÑ„ÇÑ„Å§
- https://blog.lacolaco.net/posts/1e2cf439b3c2/
- https://konifar-zatsu.hatenadiary.jp/entry/2024/11/05/192421

### Review perspective
- Scope
	- Are the goals of the PR clear?
	- Is the granularity of the PR appropriate?
- Security
	- Does merging this PR create a vulnerability?
- Performance
	- Will merging this PR cause unexpected performance degradation?
	- Is there a more efficient way?
- Testing
	- Does the test ensure the expected behavior?
	- Are there any omissions or gaps?
	- Does it check for anomalies?

## Security Advisory
### For reporter
Thank you for your reporting!

If you can also create a patch to fix the vulnerability, please create a PR on the private fork.

> [!note]
> There is a GitHub bug that prevents merging if a PR not following the develop branch of upstream, so please keep follow the develop branch.

### For misskey-dev member
‰øÆÊ≠£PR„Åådevelop„Å´ËøΩÂæì„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑ„Å®„Éû„Éº„Ç∏„Åß„Åç„Å™„ÅÑ„ÅÆ„Åß„ÄÅ„Éû„Éº„Ç∏„Åß„Åç„Å™„Åã„Å£„Åü„Çâ

> Could you merge or rebase onto upstream develop branch?

„Å™„Å©„Å®‰ºù„Åà„Çã„ÄÇ

## Deploy
The `/deploy` command by issue comment can be used to deploy the contents of a PR to the preview environment.
```
/deploy sha=<commit hash>
```
An actual domain will be assigned so you can test the federation.

## Merge

## Release
### Release Instructions
1. Commit version changes in the `develop` branch ([package.json](package.json))
2. Create a release PR.
	- Into `master` from `develop` branch.
	- The title must be in the format `Release: x.y.z`.
		- `x.y.z` is the new version you are trying to release.
3. Deploy and perform a simple QA check. Also verify that the tests passed.
4. Merge it. (Do not squash commit)
5. Create a [release of GitHub](https://github.com/misskey-dev/misskey/releases)
	- The target branch must be `master`
	- The tag name must be the version

> [!NOTE]
> Why this instruction is necessary:
> - To perform final QA checks
> - To distribute responsibility
> - To check direct commits to develop
> - To celebrate the release together üéâ

## Localization (l10n)
Misskey uses [Crowdin](https://crowdin.com/project/misskey) for localization management.
You can improve our translations with your Crowdin account.
Your changes in Crowdin are automatically submitted as a PR (with the title "New Crowdin translations") to the repository.
The owner [@syuilo](https://github.com/syuilo) merges the PR into the develop branch before the next release.

If your language is not listed in Crowdin, please open an issue. We will add it to Crowdin.
For newly added languages, once the translation progress per language exceeds 70%, it will be officially introduced into Misskey and made available to users.

![Crowdin](https://d322cqt584bo4o.cloudfront.net/misskey/localized.svg)

## Development
### Setup
Before developing, you have to set up environment. Misskey requires Redis, PostgreSQL, and FFmpeg.

You would want to install Meilisearch to experiment related features. Technically, meilisearch is not strict requirement, but some features and tests require it.

There are a few ways to proceed.

#### Use system-wide software
You could install them in system-wide (such as from package manager).

#### Use `docker compose`
You could obtain middleware container by typing `docker compose -f $PROJECT_ROOT/compose.local-db.yml up -d`.

#### Use Devcontainer
Devcontainer also has necessary setting. This method can be done by connecting from VSCode.

Instead of running `pnpm` locally, you can use Dev Container to set up your development environment.
To use Dev Container, open the project directory on VSCode with Dev Containers installed.
**Note:** If you are using Windows, please clone the repository with WSL. Using Git for Windows will result in broken files due to the difference in how newlines are handled.

It will run the following command automatically inside the container.
``` bash
git submodule update --init
pnpm install --frozen-lockfile
cp .devcontainer/devcontainer.yml .config/default.yml
pnpm build
pnpm migrate
```

After finishing the migration, you can proceed.

### Start developing
During development, it is useful to use the
```
pnpm dev
```
command.

- Server-side source files and automatically builds them if they are modified. Automatically start the server process(es).
- Vite HMR (just the `vite` command) is available. The behavior may be different from production.
- Service Worker is watched by esbuild.
- The front end can be viewed by accessing `http://localhost:5173`.
- The backend listens on the port configured with `port` in .config/default.yml.
If you have not changed it from the default, it will be "http://localhost:3000".
If "port" in .config/default.yml is set to something other than 3000, you need to change the proxy settings in packages/frontend/vite.config.local-dev.ts.

### `MK_DEV_PREFER=backend pnpm dev`
pnpm dev has another mode with `MK_DEV_PREFER=backend`.

```
MK_DEV_PREFER=backend pnpm dev
```

- This mode is closer to the production environment than the default mode.
- Vite runs behind the backend (the backend will proxy Vite at /vite).
- You can see Misskey by accessing `http://localhost:3000` (Replace `3000` with the port configured with `port` in .config/default.yml).
- To change the port of Vite, specify with `VITE_PORT` environment variable.
- HMR may not work in some environments such as Windows.

## Testing
You can run non-backend tests by executing following commands:
```sh
pnpm --filter frontend test
pnpm --filter misskey-js test
```

Backend tests require manual preparation of servers. See the next section for more on this.

### Backend
There are three types of test codes for the backend:
- Unit tests: [`/packages/backend/test/unit`](/packages/backend/test/unit)
- Single-server E2E tests: [`/packages/backend/test/e2e`](/packages/backend/test/e2e)
- Multiple-server E2E tests: [`/packages/backend/test-federation`](/packages/backend/test-federation)

#### Running Unit Tests or Single-server E2E Tests
1. Create a config file:
```sh
cp .github/misskey/test.yml .config/
```

2. Start DB and Redis servers for testing:
```sh
docker compose -f packages/backend/test/compose.yml up
```
Instead, you can prepare an empty (data can be erased) DB and edit `.config/test.yml` appropriately.

3. Run all tests:
```sh
pnpm --filter backend test     # unit tests
pnpm --filter backend test:e2e # single-server E2E tests
```
If you want to run a specific test, run as a following command:
```sh
pnpm --filter backend test -- packages/backend/test/unit/activitypub.ts
pnpm --filter backend test:e2e -- packages/backend/test/e2e/nodeinfo.ts
```

#### Running Multiple-server E2E Tests
See [`/packages/backend/test-federation/README.md`](/packages/backend/test-federation/README.md).

## Environment Variable

- `MISSKEY_CONFIG_YML`: Specify the file path of config.yml instead of default.yml (e.g. `2nd.yml`).
- `MISSKEY_WEBFINGER_USE_HTTP`: If it's set true, WebFinger requests will be http instead of https, useful for testing federation between servers in localhost. NEVER USE IN PRODUCTION.

## Continuous integration
Misskey uses GitHub Actions for executing automated tests.
Configuration files are located in [`/.github/workflows`](/.github/workflows).

## Vue
Misskey uses Vue(v3) as its front-end framework.
- Use TypeScript.
- **When creating a new component, please use the Composition API (with [setup sugar](https://v3.vuejs.org/api/sfc-script-setup.html) and [ref sugar](https://github.com/vuejs/rfcs/discussions/369)) instead of the Options API.**
	- Some of the existing components are implemented in the Options API, but it is an old implementation. Refactors that migrate those components to the Composition API are also welcome.

## nirax
nirax„ÅØ„ÄÅMisskey„Åß‰ΩøÁî®„Åó„Å¶„ÅÑ„Çã„Ç™„É™„Ç∏„Éä„É´„ÅÆ„Éï„É≠„É≥„Éà„Ç®„É≥„Éâ„É´„Éº„ÉÜ„Ç£„É≥„Ç∞„Ç∑„Çπ„ÉÜ„É†„Åß„Åô„ÄÇ
**vue-router„Åã„ÇâÂΩ±Èüø„ÇíÂ§öÂ§ß„Å´Âèó„Åë„Å¶„ÅÑ„Çã„ÅÆ„Åß„ÄÅ„Åæ„Åö„ÅØvue-router„Å´„Å§„ÅÑ„Å¶Â≠¶„Å∂„Åì„Å®„Çí„ÅäÂãß„ÇÅ„Åó„Åæ„Åô„ÄÇ**

### „É´„Éº„ÉàÂÆöÁæ©
„É´„Éº„ÉàÂÆöÁæ©„ÅØ„ÄÅ‰ª•‰∏ã„ÅÆÂΩ¢Âºè„ÅÆ„Ç™„Éñ„Ç∏„Çß„ÇØ„Éà„ÅÆÈÖçÂàó„Åß„Åô„ÄÇ

```ts
{
	name?: string;
	path: string;
	component: Component;
	query?: Record<string, string>;
	loginRequired?: boolean;
	hash?: string;
	globalCacheKey?: string;
	children?: RouteDef[];
}
```

> [!WARNING]
> ÁèæÁä∂„ÄÅ„É´„Éº„Éà„ÅØÂÆöÁæ©„Åï„Çå„ÅüÈ†Ü„Å´Ë©ï‰æ°„Åï„Çå„Åæ„Åô„ÄÇ
> „Åü„Å®„Åà„Å∞„ÄÅ`/foo/:id`„É´„Éº„ÉàÂÆöÁæ©„ÅÆÊ¨°„Å´`/foo/bar`„É´„Éº„ÉàÂÆöÁæ©„Åå„Åï„Çå„Å¶„ÅÑ„ÅüÂ†¥Âêà„ÄÅÂæåËÄÖ„Åå„Éû„ÉÉ„ÉÅ„Åô„Çã„Åì„Å®„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ

### Ë§áÊï∞„ÅÆ„É´„Éº„Çø„Éº
vue-router„Å®„ÅÆÊúÄÂ§ß„ÅÆÈÅï„ÅÑ„ÅØ„ÄÅnirax„ÅØË§áÊï∞„ÅÆ„É´„Éº„Çø„Éº„ÅåÂ≠òÂú®„Åô„Çã„Åì„Å®„ÇíË®±ÂèØ„Åó„Å¶„ÅÑ„ÇãÁÇπ„Åß„Åô„ÄÇ
„Åì„Çå„Å´„Çà„Çä„ÄÅ„Ç¢„Éó„É™ÂÜÖ„Ç¶„Ç£„É≥„Éâ„Ç¶„Åß„Éñ„É©„Ç¶„Ç∂„Å®„ÅØÂÄãÂà•„Å´„É´„Éº„ÉÜ„Ç£„É≥„Ç∞„Åô„Çã„Åì„Å®„Å™„Å©„ÅåÂèØËÉΩ„Å´„Å™„Çä„Åæ„Åô„ÄÇ

## Storybook

Misskey uses [Storybook](https://storybook.js.org/) for UI development.

### Setup & Run

#### Setup

```bash
pnpm --filter misskey-js build
```

#### Run

```bash
pnpm --filter frontend storybook-dev
```

### Usage

When you create a new component (in this example, `MyComponent.vue`), the story file (`MyComponent.stories.ts`) will be automatically generated by the `.storybook/generate.js` script.
You can override the default story by creating a impl story file (`MyComponent.stories.impl.ts`).

```ts
/* eslint-disable @typescript-eslint/explicit-function-return-type */
import { StoryObj } from '@storybook/vue3';
import MyComponent from './MyComponent.vue';
export const Default = {
	render(args) {
		return {
			components: {
				MyComponent,
			},
			setup() {
				return {
					args,
				};
			},
			computed: {
				props() {
					return {
						...this.args,
					};
				},
			},
			template: '<MyComponent v-bind="props" />',
		};
	},
	args: {
		foo: 'bar',
	},
	parameters: {
		layout: 'centered',
	},
} satisfies StoryObj<typeof MyComponent>;
```

If you want to opt-out from the automatic generation, create a `MyComponent.stories.impl.ts` file and add the following line to the file.

```ts
import MyComponent from './MyComponent.vue';
void MyComponent;
```

You can override the component meta by creating a meta story file (`MyComponent.stories.meta.ts`).

```ts
export const argTypes = {
	scale: {
		control: {
			type: 'range',
			min: 1,
			max: 4,
		},
	},
};
```

Also, you can use msw to mock API requests in the storybook. Creating a `MyComponent.stories.msw.ts` file to define the mock handlers.

```ts
import { HttpResponse, http } from 'msw';
export const handlers = [
	http.post('/api/notes/timeline', ({ request }) => {
		return HttpResponse.json([]);
	}),
];
```

Don't forget to re-run the `.storybook/generate.js` script after adding, editing, or removing the above files.

## Nest

### Nest Service Circular dependency / Nest„Åß„Çµ„Éº„Éì„Çπ„ÅÆÂæ™Áí∞ÂèÇÁÖß„Åß„Ç®„É©„Éº„ÅåËµ∑„Åç„ÅüÂ†¥Âêà

#### forwardRef
„Åæ„Åö„ÅØÁ∞°Âçò„Å´`forwardRef`„ÇíË©¶„Åó„Å¶„Åø„Çã

```typescript
export class FooService {
	constructor(
		@Inject(forwardRef(() => BarService))
		private barService: BarService
	) {
	}
}
```

#### OnModuleInit
„Åß„Åç„Å™„Åë„Çå„Å∞`OnModuleInit`„Çí‰Ωø„ÅÜ

```typescript
import { Injectable, OnModuleInit } from '@nestjs/common';
import { ModuleRef } from '@nestjs/core';
import { BarService } from '@/core/BarService';

@Injectable()
export class FooService implements OnModuleInit {
	private barService: BarService // constructor„Åã„ÇâÁßªÂãï„Åó„Å¶„Åè„Çã

	constructor(
		private moduleRef: ModuleRef,
	) {
	}

	async onModuleInit() {
		this.barService = this.moduleRef.get(BarService.name);
	}

	public async niceMethod() {
		return await this.barService.incredibleMethod({ hoge: 'fuga' });
	}
}
```

##### Service Unit Test
„ÉÜ„Çπ„Éà„Åß`onModuleInit`„ÇíÂëº„Å≥Âá∫„ÅôÂøÖË¶Å„Åå„ÅÇ„Çã

```typescript
// import ...

describe('test', () => {
	let app: TestingModule;
	let fooService: FooService; // for test case
	let barService: BarService; // for test case

	beforeEach(async () => {
		app = await Test.createTestingModule({
			imports: ...,
			providers: [
				FooService,
				{ // mock„Åô„Çã (mock„ÅØÂøÖÈ†à„Åß„ÅØ„Å™„ÅÑ„Åã„ÇÇ„Åó„Çå„Å™„ÅÑ)
					provide: BarService,
					useFactory: () => ({
						incredibleMethod: jest.fn(),
					}),
				},
				{ // Provide„Å´„Åô„Çã
					provide: BarService.name,
					useExisting: BarService,
				},
			],
		})
			.useMocker(...
			.compile();

		fooService = app.get<FooService>(FooService);
		barService = app.get<BarService>(BarService) as jest.Mocked<BarService>;

		// onModuleInit„ÇíÂÆüË°å„Åô„Çã
		await fooService.onModuleInit();
	});

	test('nice', () => {
		await fooService.niceMethod();

		expect(barService.incredibleMethod).toHaveBeenCalled();
		expect(barService.incredibleMethod.mock.lastCall![0])
			.toEqual({ hoge: 'fuga' });
	});
})
```

## Notes

### Misskey„ÅÆ„Éâ„É°„Ç§„É≥Âõ∫Êúâ„ÅÆÊ¶ÇÂøµ„ÅØ`Mi`„Çíprefix„Åô„Çã
‰æã„Åà„Å∞Google„ÅåËá™Á§æ„Çµ„Éº„Éì„Çπ„ÇíMap„ÄÅEarth„ÄÅDrive„Åß„ÅØ„Å™„ÅèGoogle Map„ÄÅGoogle Earth„ÄÅGoogle Drive„ÅÆ„Çà„ÅÜ„Å´ÂëΩÂêç„Åô„Çã„ÅÆ„Å®Âêå„Åò
„Ç≥„Éº„Éâ‰∏ä„ÅßMisskey„ÅÆ„Éâ„É°„Ç§„É≥Âõ∫Êúâ„ÅÆÊ¶ÇÂøµ„Å´„ÅØ`Mi`„Çíprefix„Åô„Çã„Åì„Å®„Åß„ÄÅ‰ªñ„ÅÆ„Éâ„É°„Ç§„É≥„ÅÆÂêåÊßò„ÅÆÊ¶ÇÂøµ„Å®Âå∫Âà•„Åß„Åç„Çã„Åª„Åã„ÄÅÂêçÂâç„ÅÆË°ùÁ™Å„ÇíÈò≤„Åê„ÄÇ
„Åü„Å†„Åó„ÄÅÊñáËÑà‰∏äMisskey„ÅÆ„ÇÇ„ÅÆ„ÇíÊåá„Åô„Åì„Å®„ÅåÊòé„Çâ„Åã„Åß„ÅÇ„Çä„ÄÅÂêçÂâç„ÅÆË°ùÁ™Å„ÅÆÊÅê„Çå„Åå„Å™„ÅÑÂ†¥Âêà„ÅØ„ÄÅ‰∏ÄÊôÇÁöÑ„Å™„É≠„Éº„Ç´„É´Â§âÊï∞„Å´Èôê„Å£„Å¶`Mi`„ÇíÁúÅÁï•„Åó„Å¶„ÇÇ„Çà„ÅÑ„ÄÇ

### How to resolve conflictions occurred at pnpm-lock.yaml?

Just execute `pnpm` to fix it.

### INSERT„Åô„Çã„Å®„Åç„Å´„ÅØsave„Åß„ÅØ„Å™„Åèinsert„Çí‰ΩøÁî®„Åô„Çã
#6441

### placeholder
SQL„Çí„ÇØ„Ç®„É™„Éì„É´„ÉÄ„ÅßÁµÑ„ÅøÁ´ã„Å¶„ÇãÈöõ„ÄÅ‰ΩøÁî®„Åô„Çã„Éó„É¨„Éº„Çπ„Éõ„É´„ÉÄ„ÅØÈáçË§á„Åó„Å¶„ÅØ„Å™„Çâ„Å™„ÅÑ
‰æã„Åà„Å∞
``` ts
query.andWhere(new Brackets(qb => {
	for (const type of ps.fileType) {
		qb.orWhere(`:type = ANY(note.attachedFileTypes)`, { type: type });
	}
}));
```
„Å®Êõ∏„Åè„Å®„ÄÅ„É´„Éº„Éó‰∏≠„Åß`type`„Å®„ÅÑ„ÅÜ„Éó„É¨„Éº„Çπ„Éõ„É´„ÉÄ„ÅåË§áÊï∞Âõû‰Ωø„Çè„Çå„Å¶„Åó„Åæ„ÅÑ„Åä„Åã„Åó„Åè„Å™„Çã
„Å†„Åã„ÇâÊ¨°„ÅÆ„Çà„ÅÜ„Å´„Åô„ÇãÂøÖË¶Å„Åå„ÅÇ„Çã
```ts
query.andWhere(new Brackets(qb => {
	for (const type of ps.fileType) {
		const i = ps.fileType.indexOf(type);
		qb.orWhere(`:type${i} = ANY(note.attachedFileTypes)`, { [`type${i}`]: type });
	}
}));
```

### Not `null` in TypeORM
```ts
const foo = await Foos.findOne({
	bar: Not(null)
});
```
„ÅÆ„Çà„ÅÜ„Å™„ÇØ„Ç®„É™(`bar`„Åå`null`„Åß„ÅØ„Å™„ÅÑ)„ÅØÊúüÂæÖÈÄö„Çä„Å´Âãï‰Ωú„Åó„Å™„ÅÑ„ÄÇ
Ê¨°„ÅÆ„Çà„ÅÜ„Å´„Åó„Åæ„Åô:
```ts
const foo = await Foos.findOne({
	bar: Not(IsNull())
});
```

### `null` in SQL
SQL„ÇíÁô∫Ë°å„Åô„ÇãÈöõ„ÄÅ„Éë„É©„É°„Éº„Çø„Åå`null`„Å´„Å™„ÇãÂèØËÉΩÊÄß„ÅÆ„ÅÇ„ÇãÂ†¥Âêà„ÅØSQLÊñá„ÇíÂá∫„ÅóÂàÜ„Åë„Å™„Åë„Çå„Å∞„Å™„Çâ„Å™„ÅÑ
‰æã„Åà„Å∞
``` ts
query.where('file.folderId = :folderId', { folderId: ps.folderId });
```
„Å®„ÅÑ„ÅÜÂá¶ÁêÜ„Åß„ÄÅ`ps.folderId`„Åå`null`„Å†„Å®ÁµêÊûúÁöÑ„Å´`file.folderId = null`„ÅÆ„Çà„ÅÜ„Å™„ÇØ„Ç®„É™„ÅåÁô∫Ë°å„Åï„Çå„Å¶„Åó„Åæ„ÅÑ„ÄÅ„Åì„Çå„ÅØÊ≠£„Åó„ÅÑSQL„Åß„ÅØ„Å™„ÅÑ„ÅÆ„ÅßÊúüÂæÖ„Åó„ÅüÁµêÊûú„ÅåÂæó„Çâ„Çå„Å™„ÅÑ
„Å†„Åã„ÇâÊ¨°„ÅÆ„Çà„ÅÜ„Å´„Åô„ÇãÂøÖË¶Å„Åå„ÅÇ„Çã
``` ts
if (ps.folderId) {
	query.where('file.folderId = :folderId', { folderId: ps.folderId });
} else {
	query.where('file.folderId IS NULL');
}
```

### `[]` in SQL
SQL„ÇíÁô∫Ë°å„Åô„ÇãÈöõ„ÄÅ`IN`„ÅÆ„Éë„É©„É°„Éº„Çø„Åå`[]`(Á©∫„ÅÆÈÖçÂàó)„Å´„Å™„ÇãÂèØËÉΩÊÄß„ÅÆ„ÅÇ„ÇãÂ†¥Âêà„ÅØSQLÊñá„ÇíÂá∫„ÅóÂàÜ„Åë„Å™„Åë„Çå„Å∞„Å™„Çâ„Å™„ÅÑ
‰æã„Åà„Å∞
``` ts
const users = await Users.find({
	id: In(userIds)
});
```
„Å®„ÅÑ„ÅÜÂá¶ÁêÜ„Åß„ÄÅ`userIds`„Åå`[]`„Å†„Å®ÁµêÊûúÁöÑ„Å´`user.id IN ()`„ÅÆ„Çà„ÅÜ„Å™„ÇØ„Ç®„É™„ÅåÁô∫Ë°å„Åï„Çå„Å¶„Åó„Åæ„ÅÑ„ÄÅ„Åì„Çå„ÅØÊ≠£„Åó„ÅÑSQL„Åß„ÅØ„Å™„ÅÑ„ÅÆ„ÅßÊúüÂæÖ„Åó„ÅüÁµêÊûú„ÅåÂæó„Çâ„Çå„Å™„ÅÑ
„Å†„Åã„ÇâÊ¨°„ÅÆ„Çà„ÅÜ„Å´„Åô„ÇãÂøÖË¶Å„Åå„ÅÇ„Çã
``` ts
const users = userIds.length > 0 ? await Users.find({
	id: In(userIds)
}) : [];
```

### ÈÖçÂàó„ÅÆ„Ç§„É≥„Éá„ÉÉ„ÇØ„Çπ in SQL
SQL„Åß„ÅØÈÖçÂàó„ÅÆ„Ç§„É≥„Éá„ÉÉ„ÇØ„Çπ„ÅØ**1Âßã„Åæ„Çä**„ÄÇ
`[a, b, c]`„ÅÆ `a`„Å´„Ç¢„ÇØ„Çª„Çπ„Åó„Åü„ÅÑ„Å™„Çâ`[0]`„Åß„ÅØ„Å™„Åè`[1]`„Å®Êõ∏„Åè

### null IN
null„ÅåÂê´„Åæ„Çå„ÇãÂèØËÉΩÊÄß„ÅÆ„ÅÇ„Çã„Ç´„É©„É†„Å´IN„Åô„Çã„Å®„Åç„ÅØ„ÄÅ„Åù„ÅÆ„Åæ„Åæ„Å†„Å®„Åä„Åã„Åó„Åè„Å™„Çã„ÅÆ„ÅßOR„Å™„Å©„Åßnull„ÅÆ„Éè„É≥„Éâ„É™„É≥„Ç∞„Çí„Åó„Çà„ÅÜ„ÄÇ

### enum„ÅÆÂâäÈô§„ÅØÊ∞ó„Çí„Å§„Åë„Çã
enum„ÅÆÂàóÊåô„ÅÆÂÜÖÂÆπ„ÅÆÂâäÈô§„ÅØ„ÄÅ„Åù„ÅÆÂÄ§„Çí„ÇÇ„Å§„É¨„Ç≥„Éº„Éâ„ÇíÂÖ®„Å¶ÂâäÈô§„Åó„Å™„ÅÑ„Å®„ÅÑ„Åë„Å™„ÅÑ

ÂâäÈô§„ÅåÈáç„Åü„Åã„Å£„Åü„Çä‰∏çÂèØËÉΩ„Å†„Å£„Åü„Çä„Åô„ÇãÂ†¥Âêà„ÅØ„ÄÅÂâäÈô§„Åó„Å™„ÅÑ„Åß„Åä„Åè

### Migration‰ΩúÊàêÊñπÊ≥ï
packages/backend„Åß:
```sh
pnpm dlx typeorm migration:generate -d ormconfig.js -o <migration name>
```

- ÁîüÊàêÂæå„ÄÅ„Éï„Ç°„Ç§„É´„Çímigration‰∏ã„Å´Áßª„Åó„Å¶„Åè„Å†„Åï„ÅÑ
- ‰ΩúÊàê„Åï„Çå„Åü„Çπ„ÇØ„É™„Éó„Éà„ÅØ‰∏çÂøÖË¶Å„Å™Â§âÊõ¥„ÇíÂê´„ÇÄ„Åü„ÇÅÈô§Âéª„Åó„Å¶„Åè„Å†„Åï„ÅÑ

### JSON Schema„ÅÆobject„ÅßanyOf„Çí‰Ωø„ÅÜ„Å®„Åç
JSON Schema„Åß„ÄÅobject„Å´ÂØæ„Åó„Å¶anyOf„Çí‰Ωø„ÅÜÂ†¥Âêà„ÄÅanyOf„ÅÆ‰∏≠„Åßproperties„ÇíÂÆöÁæ©„Åó„Å™„ÅÑ„Åì„Å®„ÄÇ
„Éê„É™„Éá„Éº„Ç∑„Éß„É≥„ÅåÂäπ„Åã„Å™„ÅÑ„Åü„ÇÅ„ÄÇÔºàSchemaType„ÇÇ„Åù„ÅÆ„Çà„ÅÜ„Å´‰Ωú„Çâ„Çå„Å¶„Åä„Çä„ÄÅobject„ÅÆanyOfÂÜÖ„ÅÆproperties„ÅØÊç®„Å¶„Çâ„Çå„Åæ„ÅôÔºâ
https://github.com/misskey-dev/misskey/pull/10082

„ÉÜ„Ç≠„Çπ„Éàhoge„Åä„Çà„Å≥fuga„Å´„Å§„ÅÑ„Å¶„ÄÅÁâáÊñπ„ÇíÂøÖÈ†à„Å®„Åó„Å§„Å§‰∏°Êñπ„ÅÆÊåáÂÆö„ÇÇ„ÅÇ„Çä„ÅÜ„ÇãÂ†¥Âêà:

```ts
export const paramDef = {
	type: 'object',
	properties: {
		hoge: { type: 'string', minLength: 1 },
		fuga: { type: 'string', minLength: 1 },
	},
	anyOf: [
		{ required: ['hoge'] },
		{ required: ['fuga'] },
	],
} as const;
```

### „Ç≥„Éç„ÇØ„Ç∑„Éß„É≥„Å´„ÅØ`markRaw`„Åõ„Çà
**Vue„ÅÆ„Ç≥„É≥„Éù„Éº„Éç„É≥„Éà„ÅÆdata„Ç™„Éó„Ç∑„Éß„É≥„Å®„Åó„Å¶**misskey.js„ÅÆ„Ç≥„Éç„ÇØ„Ç∑„Éß„É≥„ÇíË®≠ÂÆö„Åô„Çã„Å®„Åç„ÄÅÂøÖ„Åö`markRaw`„Åß„É©„ÉÉ„Éó„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ„Ç§„É≥„Çπ„Çø„É≥„Çπ„Åå‰∏çÂøÖË¶Å„Å´„É™„Ç¢„ÇØ„ÉÜ„Ç£„ÉñÂåñ„Åï„Çå„Çã„Åì„Å®„Åß„ÄÅmisskey.jsÂÜÖ„ÅÆÂá¶ÁêÜ„Åß‰∏çÂÖ∑Âêà„ÅåÁô∫Áîü„Åô„Çã„Å®„Å®„ÇÇ„Å´„ÄÅ„Éë„Éï„Ç©„Éº„Éû„É≥„Çπ‰∏ä„ÅÆÂïèÈ°å„Å´„ÇÇÁπã„Åå„Çã„ÄÇ„Å™„Åä„ÄÅComposition API„Çí‰Ωø„ÅÜÂ†¥Âêà„ÅØ„Åì„ÅÆÈôê„Çä„Åß„ÅØ„Å™„ÅÑ(„É™„Ç¢„ÇØ„ÉÜ„Ç£„ÉñÂåñ„ÅØ„Éû„Éã„É•„Ç¢„É´„Å™„Åü„ÇÅ)„ÄÇ

### JSON„ÅÆimport„Å´Ê∞ó„Çí‰ªò„Åë„Çà„ÅÜ
TypeScript„Åßjson„Çíimport„Åô„Çã„Å®„ÄÅtsc„Åß„Ç≥„É≥„Éë„Ç§„É´„Åô„Çã„Å®„Åç„Å´„Åù„ÅÆjson„Éï„Ç°„Ç§„É´„ÇÇ‰∏ÄÁ∑í„Å´dist„Éá„Ç£„É¨„ÇØ„Éà„É™„Å´Âêê„ÅçÂá∫„Åï„Çå„Å¶„Åó„Åæ„ÅÜ„ÄÇ„Åì„ÅÆÊåôÂãï„Å´„Çà„Çä„ÄÅÊÑèÂõ≥„Åõ„Åö„Éï„Ç°„Ç§„É´„ÅÆÊõ∏„ÅçÊèõ„Åà„ÅåÁô∫Áîü„Åô„Çã„Åì„Å®„Åå„ÅÇ„Çã„ÅÆ„Åß„ÄÅjson„Çíimport„Åô„Çã„Å®„Åç„ÅØÊõ∏„ÅçÊèõ„Åà„Çâ„Çå„Å¶„ÇÇËâØ„ÅÑ„ÇÇ„ÅÆ„Åã„Å©„ÅÜ„ÅãÁ¢∫Ë™ç„Åô„Çã„Åì„Å®„ÄÇÊõ∏„ÅçÊèõ„Åà„Åï„Çå„Å¶Ê¨≤„Åó„Åè„Å™„ÅÑÂ†¥Âêà„ÅØ„ÄÅimport„ÅßË™≠„ÅøËæº„ÇÄ„ÅÆ„Åß„ÅØ„Å™„Åè„ÄÅ`fs.readFileSync`„Å™„Å©„ÅÆÈñ¢Êï∞„Çí‰Ωø„Å£„Å¶Ë™≠„ÅøËæº„ÇÄ„Çà„ÅÜ„Å´„Åô„Çå„Å∞„Çà„ÅÑ„ÄÇ

### „Ç≥„É≥„Éù„Éº„Éç„É≥„Éà„ÅÆ„Çπ„Çø„Ç§„É´ÂÆöÁæ©„Åßmargin„ÇíÊåÅ„Åü„Åõ„Å™„ÅÑ
„Ç≥„É≥„Éù„Éº„Éç„É≥„ÉàËá™Ë∫´„Ååmargin„ÇíË®≠ÂÆö„Åô„Çã„ÅÆ„ÅØÂïèÈ°å„ÅÆÂÖÉ„Å®„Å™„Çã„Åì„Å®„ÅØ„Çà„ÅèÁü•„Çâ„Çå„Å¶„ÅÑ„Çã
margin„ÅØ„Åù„ÅÆ„Ç≥„É≥„Éù„Éº„Éç„É≥„Éà„Çí‰Ωø„ÅÜÂÅ¥„ÅåË®≠ÂÆö„Åô„Çã

## „Åù„ÅÆ‰ªñ
### HTML„ÅÆ„ÇØ„É©„ÇπÂêç„Åß follow „Å®„ÅÑ„ÅÜÂçòË™û„ÅØ‰Ωø„Çè„Å™„ÅÑ
Â∫ÉÂëä„Éñ„É≠„ÉÉ„Ç´„Éº„ÅßË™§„Å£„Å¶„Éñ„É≠„ÉÉ„ÇØ„Åï„Çå„Çã

### index„Å®„ÅÑ„ÅÜ„Éï„Ç°„Ç§„É´Âêç„Çí‰Ωø„ÅÜ„Å™
ESM„Åß„ÅØ„Éá„Ç£„É¨„ÇØ„Éà„É™„Ç§„É≥„Éù„Éº„Éà„ÅØÂªÉÊ≠¢„Åï„Çå„Å¶„ÅÑ„Çã„ÅÆ„Å®„ÄÅ„Éá„Ç£„É¨„ÇØ„Éà„É™„Ç§„É≥„Éù„Éº„Éà„Åõ„Åö„Å®„ÇÇ„Éï„Ç°„Ç§„É´Âêç„Åå index „Å†„Å®‰ΩïÊïÖ„Åã‰∏ÄÈÉ®„ÅÆ„É©„Ç§„Éñ„É©„É™Ôºü„Åß„Éá„Ç£„É¨„ÇØ„Éà„É™„Ç§„É≥„Éù„Éº„Éà„Å†„Å®Ë¶ãÂÅö„Åï„Çå„Å¶„Ç®„É©„Éº„Å´„Å™„Çã

## CSS Recipe

### Lighten CSS vars

``` css
color: hsl(from var(--MI_THEME-accent) h s calc(l + 10));
```

### Darken CSS vars

``` css
color: hsl(from var(--MI_THEME-accent) h s calc(l - 10));
```

### Add alpha to CSS vars

``` css
color: color(from var(--MI_THEME-accent) srgb r g b / 0.5);
```

